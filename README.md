# NATaSSHka

**NATaSSHka — encrypted messages and calls in your browser**

Безопасный мессенджер-приложение с **end‑to‑end шифрованием**, поддерживающее текстовые сообщения, голосовые и видео сообщения, обмен файлами и звонки (аудио/видео) прямо в браузере.

---
- [Функции](#функции)  
- [Сходство с другими мессенджерами](#сходство-с-другими-мессенджерами)  
- [Преимущества и возможности](#преимущества-и-возможности)  
- [Установка и конфигурация](#установка-и-конфигурация)
- [Запуск локально и тестирование](#запуск-локально-и-тестирование)
- [Шифрование и дешифрация](#шифрование-и-дешифрация)
- [Параметры `config.json`](#параметры-configjson)  
- [Лицензия](#лицензия)  

---

## Функции
- Отправка и получение **текстовых сообщений** в реальном времени  
- Запись и отправка **голосовых сообщений**  
- Запись и отправка **видео сообщений**  
- Аудио/видео звонки через WebRTC  
- Обмен любыми файлами (при ограничении размера)  
- End‑to‑end шифрование текста и файлов на стороне клиента  
- Поддержка комнат (room‑чатов) для приватного общения  
- История сообщений: сохранение сообщений в комнате (на сервере, в зашифрованном виде)  
- Возможность удаления/очистки чата или всех чатов (через специальные коды)  

---

## Сходство с другими мессенджерами

NATaSSHka по своим функциям напоминает:

- **Telegram** — безопасная передача файлов, акцент на приватность  
- **WhatsApp** — голосовые и видео сообщения, звонки + обмен медиа  
- **Signal** — сильное end‑to‑end шифрование, защита данных  

---

## Преимущества и возможности

- **Конфиденциальность и безопасность** — данные шифруются на клиенте, сервер не имеет доступа к открытым сообщениям или файлам  
- **Контроль над ключом шифрования** — пользователь сам задаёт/держит ключ, сервер не хранит его  
- **Без регистрации** — базовый доступ может быть по паролю, нет необходимости в сложной авторизации  
- **Поддержка разных медиаформатов** — текст, голос, видео, файлы  
- **Гибкость конфигурации** — можно настраивать параметры WebRTC, аудио/видео качества, лимит файлов и т.д.  
- **Открытый исходный код** — можно проверить, адаптировать, внести изменения  

---

## Установка и конфигурация

### Предварительные требования

- Node.js версии 14 или выше  
- npm (идёт вместе с Node.js)  
- Доступ к интернету при первом запуске (если используются STUN / TURN)  
- Браузер (Chrome, или любой современный)  

### Последовательность установки

1. Клонировать репозиторий:

   ```bash
   git clone https://github.com/VlasovAlexey/NATaSSHka.git
   cd NATaSSHka
   ```
   или скачать zip архив репозитория.

2. Установить зависимости:

   ```bash
   npm install express
   ```

3. Настроить файл `config.json` (при желании использовать значения по умолчанию или изменить).  

4. Запустить сервер:

   ```bash
   node server.js
   ```

   или, если на Windows, используя `start_server.bat`.

---

## Параметры `config.json`

`config.json` содержит настройки, влияющие на поведение приложения. Вот описание полей:

| Параметр | Тип | Что задаёт / назначение |
|---|---|---|
| `port` | number | Порт, на котором запускается сервер (например, 3000) |
| `password` | string | Пароль, необходимый для доступа к чату / комнате |
| `stunServers` | array of objects | Список STUN‑серверов для WebRTC (для установления соединений через NAT) |
| `killCode` | string | Кодовое слово, при отправке которого очищается чат и удаляются файлы в **текущей комнате** |
| `killAllCode` | string | Кодовое слово, при отправке которого очищаются **все комнаты**, файлы, и возможно выключается сервер (зависит от реализации) |
| `maxFileSize` | number | Максимальный размер файла в байтах, который разрешается отправлять |
| `audio` | object | Настройки аудио записи (sampleRate, sampleSize, mimeType и др.) |
| `rtc_video` | object | Настройки видео для WebRTC звонков (размер, fps и др.) |
| `rtc_audio` | object | Настройки аудио для WebRTC (количество каналов, echo‑cancellation, шумоподавление и др.) |
| `videoRec_width`, `videoRec_height`, `videoRec_frameRate`, `videoRec_bitrate`, `videoRec_mimeType` | number / string | Параметры, используемые при записи видео сообщений: ширина, высота, кадровая частота, битрейт, MIME‑тип |
| `encryptionDebounceDelay` | number | Задержка (в миллисекундах) перед перерасшифровкой сообщений при смене ключа шифрования (чтобы не перегружать интерфейс) |

---

## Запуск локально и тестирование

1. Убедитесь, что конфигурация `config.json` корректна и порт, пароль и STUN‑серверы заданы.  

2. Запустите сервер:

   ```bash
   node server.js
   ```

   или через скрипт `start_server.bat` (если есть).  

3. Откройте браузер Chrome и перейдите по адресу:

   ```
   http://localhost:<порт>
   ```

   Например, если `port` = 3000 → `http://localhost:3000`

4. При первом обращении браузер запросит разрешение на доступ к микрофону и камере — подтвердите, если хотите использовать звонки.

5. В интерфейсе ввести своё имя пользователя, выбрать комнату (например, по умолчанию “Room_01”) и ввести пароль (если он задан в `config.json`).

6. Тестирование звонков:

   - Откройте второе окно браузера (можно в режиме инкогнито), зайдите под другим именем и той же комнате и с тем же паролем.  
   - Проверьте, что голосовые/видео сообщения отправляются, звонки устанавливаются, файлы шифруются и расшифровываются, медиа отображаются.

---

## Шифрование и дешифрация

### Как это работает

- Клиент задаёт ключ шифрования (password/key) — этот ключ известен **только клиенту(ам)**, не серверу.  
- При отправке текстового сообщения или файла клиент шифрует данные с помощью AES используя CryptoJS.  
- Если сообщение помечено как зашифрованное (`isEncrypted` или аналогичный флаг), сервер сохраняет и пересылает **зашифрованный текст/контент**, не имея возможности его прочитать.  
- При получении сообщения клиент проверяет: если есть ключ шифрования — пытается расшифровать. Если ключ верный — показывается исходный текст/файл/медиа, иначе — сообщение об ошибке (“неверный ключ шифрования”).  
- Для файлов: медиа (аудио, видео, изображения) могут отображаться с отложенной дешифровкой, то есть файл может быть загружен, но не расшифрован до момента, когда он нужен для просмотра/прослушивания.

### Преимущества шифрования на клиентах

- Сервер никогда не видит открытых данных — даже при компрометации сервера злоумышленник не получит текст/содержимое файлов.  
- Пользователь контролирует ключ — можно менять, хранить локально, не передавать никуда.  
- Повышенная приватность и безопасность, соответствуют требованиям конфиденциального обмена информацией.  
- Совместимость с принципами, используемыми в Signal, WhatsApp, Telegram при end‑to‑end шифровании.

---

## Лицензия
Проект лицензируется под **MIT License**.  
Смотрите файл [`LICENSE`](LICENSE) для деталей.
