# NATaSSHka encrypted messages and calls in your browser
NATaSSHka - это безопасное мессенджер-приложение с end-to-end шифрованием, поддерживающее текстовые сообщения, голосовые сообщения, видео сообщения и обмен файлами. Приложение построено на Node.js, Express и Socket.io с использованием WebRTC для аудио и видео звонков.

# Функциональность
Текстовые сообщения: Отправка и получение текстовых сообщений в реальном времени

Голосовые сообщения: Запись и отправка голосовых сообщений

Видео сообщения: Запись и отправка видео сообщений

Обмен файлами: Отправка любых файлов с шифрованием

Аудио и видео звонки: WebRTC звонки между пользователями

Шифрование: End-to-end шифрование текстовых сообщений и файлов

Комнаты: Создание комнат для приватного общения

История сообщений: Сохранение истории сообщений в комнате

# Сходство с другими мессенджерами
NATaSSHka сочетает в себе функции таких мессенджеров, как:

Telegram: Безопасность, шифрование, отправка файлов

WhatsApp: Голосовые и видео сообщения, звонки

Signal: Сильное end-to-end шифрование

# Возможности
Безопасность: Все данные шифруются на клиенте перед отправкой. Не требуется регистрация где либо или как либо. Свободный доступ в чат по паролю

Приватность: Сервер не имеет доступа к расшифрованным данным

Гибкость: Поддержка различных типов медиа

Размер: Весь мессенджер помещается в 500Kb и может быть загружен в любой доступный AI для анализа кода на безопасность

Открытый исходный код: Позволяет проверить код и внести любые изменения

Кроссплатформенность: Работает в любом современном браузере

# Установка и конфигурация
Предварительные требования
Node.js (версия 14 или выше)

npm (обычно идет вместе с Node.js)

Последовательность установки
Клонируйте репозиторий:

bash
git clone <repository-url>
cd natasshka
Установите зависимости:

bash
npm install
Настройте конфигурационный файл config.json (опционально, можно использовать значения по умолчанию):

json
{
  "port": 3000,
  "password": "pass",
  "stunServers": [
    {"urls": "stun:stun.l.google.com:19302"},
    {"urls": "stun:stun1.l.google.com:19302"}
  ],
  "killCode": "kill",
  "killAllCode": "killall",
  "maxFileSize": 52428800,
  "audio": {
    "sampleRate": 44100,
    "sampleSize": 16,
    "mimeType": "audio/webm"
  },
  "rtc_video": {
    "width": 640,
    "height": 480,
    "frameRate": 30
  },
  "rtc_audio": {
    "channelCount": 1,
    "sampleRate": 44100,
    "sampleSize": 16,
    "echoCancellation": true,
    "noiseSuppression": true
  },
  "videoRec_width": 640,
  "videoRec_height": 480,
  "videoRec_frameRate": 30,
  "videoRec_bitrate": 2500000,
  "videoRec_mimeType": "video/webm;codecs=vp9",
  "encryptionDebounceDelay": 500
}
# Описание параметров config.json:
port: Порт, на котором запускается сервер

password: Пароль для доступа к чату

stunServers: STUN серверы для WebRTC

killCode: Кодовое слово для очистки чата и удаления файлов в текущей комнате

killAllCode: Кодовое слово для очистки всех чатов, удаления всех файлов и выключения сервера

maxFileSize: Максимальный размер файла в байтах (по умолчанию 50 МБ)

audio: Настройки аудио для записи

rtc_video: Настройки видео для WebRTC

rtc_audio: Настройки аудио для WebRTC

videoRec_width, videoRec_height, videoRec_frameRate, videoRec_bitrate, videoRec_mimeType: Настройки для записи видео

encryptionDebounceDelay: Задержка перед перешифровкой сообщений при смене ключа (в миллисекундах)

#Запустите сервер:

bash
node server.js
Или используйте start_server.bat на Windows.

Откройте браузер и перейдите по адресу http://localhost:3000.

Локальное тестирование в Chrome
Убедитесь, что сервер запущен на localhost:3000

Откройте Google Chrome и перейдите по адресу http://localhost:3000

При первом использовании разрешите доступ к микрофону и камере, когда браузер запросит разрешение

Введите имя пользователя, комнату (по умолчанию "Room_01") и пароль (по умолчанию "pass")

Начните общение: отправляйте текстовые сообщения, файлы, записывайте голосовые и видео сообщения

Примечание: Для тестирования звонков откройте второе окно браузера (можно в режиме инкогнито) и войдите под другим именем пользователя.

# Шифрование и дешифрование

Шифрование текстовых сообщений:
Сообщения шифруются с помощью CryptoJS AES перед отправкой на сервер.

При получении сообщения с флагом isEncrypted клиент пытается расшифровать его текущим ключом.

Если ключ не подходит или не установлен, отображается сообщение "🔒 Неверный ключ шифрования".

Шифрование файлов:
Файлы шифруются на клиенте перед отправкой и хранятся на сервере в зашифрованном виде.

При получении файла клиент проверяет флаг isEncrypted и, если нужно, дешифрует файл перед отображением.

Для изображений, видео и аудио используется отложенная дешифровка при отображении.

Обработка ошибок:
При ошибке дешифрования (неверный ключ) показывается соответствующее сообщение.

Реализован механизм debounce для перерасшифровки сообщений при изменении ключа.

Совместимость:
Сообщения, отправленные без шифрования, отображаются как обычный текст.

Зашифрованные сообщения требуют правильный ключ для отображения.

Теперь мессенджер обеспечивает сквозное шифрование для текстовых сообщений и файлов, при этом ключ шифрования известен только пользователям и никогда не передается на сервер.

# Как это работает
Шифрование на клиенте:

При отправке текстового сообщения или файла, если пользователь указал ключ шифрования, данные шифруются на стороне клиента с использованием алгоритма AES (реализация CryptoJS)

Зашифрованные данные отправляются на сервер и хранятся там в зашифрованном виде

# Дешифрование на клиенте:
При получении зашифрованных данных клиент пытается расшифровать их с использованием текущего ключа. Если ключ верный, данные расшифровываются и отображаются. Если ключ неверный, отображается сообщение об ошибке.

# Преимущества шифрования на клиенте
Конфиденциальность: Сервер никогда не видит незашифрованные данные

Безопасность: Даже если сервер будет скомпрометирован, данные останутся защищенными

Контроль: Пользователи сами управляют ключами шифрования

# Процесс шифрования файлов
Пользователь выбирает файл для отправки.

Если установлен ключ шифрования, файл читается и преобразуется в base64.

Base64 строка шифруется с использованием ключа.

Зашифрованные данные отправляются на сервер.

При получении файла, если он зашифрован, клиент пытается расшифровать его с помощью текущего ключа.

# Лицензия
Этот проект лицензирован по лицензии MIT. Подробнее см. в файле LICENSE
